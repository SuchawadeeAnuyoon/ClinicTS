# steps:
#  # build the container
#  - name: 'gcr.io/cloud-builders/docker'
#    args: ['build', '--network=cloudbuild','-t', 'gcr.io/thasung-clinic/server', '.']
#  # push the container image to Container Registry
#  - name: 'gcr.io/cloud-builders/docker'
#    args: ['push', 'gcr.io/thasung-clinic/server']
#  # Deploy container image to Cloud Run
#  - name: 'gcr.io/cloud-builders/gcloud'
#    args: ['run', 'deploy', 'thasung-server', '--image', 'gcr.io/thasung-clinic/server', '--region', 'asia-northeast1', '--platform', 'managed', '--allow-unauthenticated']
# images:
# - 'gcr.io/thasung-clinic/server'

steps:
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        docker pull gcr.io/thasung-clinic/server:latest || exit 0
  - name: gcr.io/cloud-builders/docker
    timeout: 1200s
    args:
      [
        'build',
        '-f',
        'DockerFile',
        '-t',
        'gcr.io/thasung-clinic/server',
        '--cache-from',
        'gcr.io/thasung-clinic/server:latest',
        '.',
      ]
timeout: 1200s
images:
  - gcr.io/thasung-clinic/server
